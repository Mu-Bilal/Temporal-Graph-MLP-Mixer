Code copied from HDTTS GitHub repository and slightly modified.